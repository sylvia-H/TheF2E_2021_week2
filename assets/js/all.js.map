{"version":3,"sources":["_bike.js","_index.js","_valid.js"],"names":["pos_latitude","pos_longitude","bikeMap","bikeStation_lendData","getBikeStation_nearby_Data","endpoint","axios","get","headers","getAuthorizationHeader","then","response","thisData","data","forEach","el","lat","lon","stationName","StationPosition","PositionLat","PositionLon","StationName","Zh_tw","console","log","StationUID","popUpContent","StationAddress","lendIcon","L","divIcon","iconSize","iconAnchor","popupAnchor","html","marker","icon","addTo","bindPopup","setPopupContent","iconTag","error","getBikeStation_nearby2_Data","targetStation","filter","stationIcon","document","querySelector","isLendBike","innerHTML","AvailableRentBikes","AvailableReturnBikes","addEventListener","getBikeStation_nearby2_popUp","e","target","getAttribute","setTimeout","getNums","rentBikes","getElementById","returnBikes","stationStatus","ServiceStatus","innerText","classList","add","getPosition","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","UNKNOWN_ERROR","success","pos","coords","latitude","longitude","navigator","geolocation","watchPosition","alert","bike_init","map","center","zoom","setView","tileLayer","attribution","maxZoom","id","tileSize","zoomOffset","accessToken","posGpsIcon","gpsYoubike","lottie","loadAnimation","wrapper","lottie_GPS","animType","loop","autoplay","path","play","window","onload","nav_rentSwitch","nav_parkingSwitch","footer_rentSwitch","footer_parkingSwitch","rentSwitch","checked","parkingSwitch","logoYoubike","lottie_youbike","AppID","AppKey","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","HMAC","getHMAC","Authorization"],"mappings":"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","file":"all.js","sourcesContent":["let pos_latitude;\r\nlet pos_longitude;\r\nlet bikeMap;\r\n// 站點進階資訊\r\nlet bikeStation_lendData = [];\r\n\r\n// 取得附近一公里內 30 筆站點資訊:在地圖上呈現 lend 租車標記 icon\r\nfunction getBikeStation_nearby_Data(){\r\n  const endpoint = `https://ptx.transportdata.tw/MOTC/v2/Bike/Station/NearBy?$top=30&$spatialFilter=nearby(${pos_latitude},${pos_longitude},1000)&$format=JSON`;\r\n\r\n  axios.get(endpoint,\r\n     {\r\n        headers: getAuthorizationHeader()\r\n     })\r\n    .then(function (response) {\r\n      const thisData = response.data;\r\n    \r\n      thisData.forEach(el=>{\r\n        let lat;\r\n        let lon;\r\n        let stationName = \"\";\r\n        \r\n        if(el.StationPosition.PositionLat) {\r\n          lat = el.StationPosition.PositionLat;\r\n        } else {\r\n          lat = pos_latitude;\r\n        }\r\n        if(el.StationPosition.PositionLon) {\r\n          lon = el.StationPosition.PositionLon;\r\n        } else {\r\n          lon = pos_longitude;\r\n        }\r\n        \r\n        if(el.StationName) {\r\n          stationName = el.StationName.Zh_tw;\r\n        } else {\r\n          stationName = \"\";\r\n        }\r\n        \r\n        console.log(el.StationUID);\r\n        console.log(`lat:${lat},lon:${lon},stationName:${stationName}`);\r\n        \r\n        // popUp 內容\r\n        let popUpContent = `\r\n          <p class=\"fz-5 fw-bold my-4 me-2\">${stationName}</p>\r\n          <a class=\"rounded-pill bg-blue text-white py-2 px-3 mb-2\" href=\"https://www.google.com/maps/search/?api=1&map_action=map&zoom=16&query=(${el.StationAddress.Zh_tw})\">\r\n            使用 GoogleMap 導航\r\n          </a>\r\n          <span id=\"${el.StationUID}_status\" class=\"fz-3 badge py-2 px-2 ms-2\"></span>\r\n          <div class=\"row d-flex\">\r\n            <div class=\"col-6 py-3 fz-3 fw-bold text-center\">\r\n              可借車輛\r\n              <p id=\"${el.StationUID}_RentBikes\" class=\"fz-10 fw-bold text-success m-0\"></p>\r\n            </div>\r\n            <div class=\"col-6 py-3 fz-3 fw-bold text-center\">\r\n              可停空位\r\n              <p id=\"${el.StationUID}_ReturnBikes\" class=\"fz-10 fw-bold text-warning m-0\"></p>\r\n            </div>\r\n          </div>`;\r\n        \r\n        // 站點圖示\r\n        let lendIcon = L.divIcon({\r\n          iconSize: [0,0],\r\n          iconAnchor: [22, 94],\r\n          popupAnchor: [-3, -76],\r\n          html: `\r\n          <div class=\"lendIcon\">\r\n            <img src=\"./assets/images/icons/stationMark_yellow.png\"/>\r\n            <div class=\"bikeNum\">\r\n              <span class=\"${el.StationUID}\"></span>\r\n            </div>\r\n          </div`\r\n        });\r\n\r\n        // 標記站點黃色 icon & 為站點綁上 popUp 彈跳視窗\r\n        L.marker([lat,lon], {icon: lendIcon})\r\n        .addTo(bikeMap).bindPopup().setPopupContent(popUpContent);\r\n        \r\n        // 用 StationUID 查詢站點借還車輛資訊，並在 icon 上標記數量\r\n        iconTag(el.StationUID);\r\n        \r\n      });\r\n\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error);\r\n    }); \r\n\r\n}\r\n\r\n// 取得附近一公里內 30 筆站點進階資訊\r\nfunction getBikeStation_nearby2_Data(){\r\n  const endpoint = `https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/NearBy?$top=30&$spatialFilter=nearby(${pos_latitude},${pos_longitude},1000)&$format=JSON`;\r\n  axios.get(endpoint,\r\n     {\r\n        headers: getAuthorizationHeader()\r\n     }\r\n    )\r\n    .then(function (response) {\r\n      bikeStation_lendData = response.data;\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error);\r\n    }); \r\n}\r\n\r\n\r\n// 在 icon 上標記 lend 可借車輛數量\r\nfunction iconTag(StationUID){\r\n      const targetStation = bikeStation_lendData.filter(el=> el.StationUID === StationUID);\r\n      const stationIcon = document.querySelector(`.${StationUID}`);\r\n      if(isLendBike){\r\n        stationIcon.innerHTML = targetStation[0].AvailableRentBikes;\r\n      } else {\r\n        stationIcon.innerHTML = targetStation[0].AvailableReturnBikes;\r\n      }\r\n      stationIcon.addEventListener('click',getBikeStation_nearby2_popUp);\r\n}\r\n\r\n\r\n// 點擊 popUp：呈現借還車輛數量資訊\r\nfunction getBikeStation_nearby2_popUp(e){\r\n  // 取點擊站點的 StationUID\r\n  const StationUID = e.target.getAttribute('Class');\r\n\r\n  // 延遲執行抓取 DOM 元素\r\n  setTimeout(getNums,200);\r\n  function getNums(){\r\n    // 站點可借還車輛數量\r\n    const rentBikes = document.getElementById(`${StationUID}_RentBikes`);\r\n    const returnBikes = document.getElementById(`${StationUID}_ReturnBikes`);\r\n    const targetStation = bikeStation_lendData.filter(el=> el.StationUID === StationUID);\r\n    rentBikes.innerHTML = targetStation[0].AvailableRentBikes;\r\n    returnBikes.innerHTML = targetStation[0].AvailableReturnBikes;\r\n    // 站點營運狀態\r\n    const stationStatus = document.getElementById(`${StationUID}_status`);\r\n    switch (targetStation[0].ServiceStatus) {\r\n      // [0:'停止營運',1:'正常營運',2:'暫停營運'] \r\n      case 0:\r\n        stationStatus.innerText = '停止營運';\r\n        stationStatus.classList.add('bg-danger');\r\n        break;\r\n      case 1:\r\n        stationStatus.innerText = '正常營運';\r\n        stationStatus.classList.add('bg-success');\r\n        break;\r\n      case 2:\r\n        stationStatus.innerText = '暫停營運';\r\n        stationStatus.classList.add('bg-dark');\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n// 取得使用者所在位置\r\nfunction getPosition(){\r\n  // 錯誤訊息處理\r\n  function error(error){\r\n    // 若出現錯誤，先自動將定位定在台北市中心\r\n    pos_latitude = 25.04;\r\n    pos_longitude = 121.54;\r\n    switch(error.code)  {\r\n      case error.PERMISSION_DENIED:\r\n          console.log(\"User denied the request for Geolocation.\");\r\n          break;\r\n\r\n      case error.POSITION_UNAVAILABLE:\r\n          console.log(\"Location information is unavailable.\");\r\n          break;\r\n\r\n      case error.TIMEOUT:\r\n          console.log(\"The request to get user location timed out.\");\r\n          break;\r\n\r\n      case error.UNKNOWN_ERROR:\r\n          console.log(\"An unknown error occurred.\");\r\n          break;\r\n    }\r\n  }\r\n\r\n  function success(pos){\r\n    pos_latitude = pos.coords.latitude;\r\n    pos_longitude = pos.coords.longitude;\r\n    console.log(pos.coords.latitude,pos.coords.longitude);\r\n  }\r\n  \r\n  if(navigator.geolocation){\r\n    // navigator.geolocation.getCurrentPosition(success, error);\r\n    navigator.geolocation.watchPosition(success, error);\r\n  } else {\r\n    // 若出現錯誤，先自動將定位定在台北市中心\r\n    pos_latitude = 25.04;\r\n    pos_longitude = 121.54;\r\n    alert('您的裝置不支援地理位置功能');\r\n  }\r\n}\r\n\r\n// Bike 頁面：初始化渲染／呈現地圖圖資／標記 GPS 圖示／標記附近站點\r\nfunction bike_init(){\r\n  console.log(`pos_latitude：${pos_latitude}`);\r\n  console.log(`pos_longitude：${pos_longitude}`);\r\n  \r\n  // 取得附近站點進階資訊\r\n  getBikeStation_nearby2_Data();\r\n\r\n  // 呈現地圖圖資\r\n  bikeMap = L.map('bikeMap_show', {\r\n      center: [pos_latitude,pos_longitude],\r\n      zoom: 16\r\n  }).setView([pos_latitude,pos_longitude], 16);\r\n\r\n  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\r\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n      maxZoom: 18,\r\n      id: 'mapbox/streets-v11',\r\n      tileSize: 512,\r\n      zoomOffset: -1,\r\n      accessToken: 'pk.eyJ1Ijoic3lsdmlhaC10dyIsImEiOiJja3c2Nzl2eHUweXlmMnFtZTRjb2VjcDQxIn0.Gx5M_zr8rDs4T-jawF2UDQ'\r\n  }).addTo(bikeMap);\r\n\r\n  // 目前所在位置 GPS 圖示內容\r\n  let posGpsIcon = L.divIcon({\r\n      iconSize: [70,70],\r\n      html: `<div id=\"lottie_GPS\"></div>`\r\n  });\r\n  \r\n  // 在地圖上標記所在位置 GPS 圖示\r\n  L.marker([pos_latitude,pos_longitude], {icon: posGpsIcon}).addTo(bikeMap);\r\n\r\n  // 顯示所在位置 GPS 圖示 lottie 動畫\r\n  const gpsYoubike = lottie.loadAnimation({\r\n    wrapper: lottie_GPS,\r\n    animType: 'svg',\r\n    loop: true,\r\n    autoplay: false,\r\n    path: './assets/images/youbike_GPS.json'\r\n  });\r\n  gpsYoubike.play();\r\n\r\n  // 標記附近站點 - 可借車輛資訊\r\n  getBikeStation_nearby_Data();\r\n\r\n}\r\n\r\n// Bike 頁面初始渲染：取得目前所在位置經緯度座標\r\nwindow.onload = getPosition();\r\n\r\n// Bike 頁面初始渲染：延遲執行地圖載入\r\nsetTimeout(bike_init, 800);\r\n\r\n// 監聽目前欲查詢狀態：租車 or 還車\r\nlet isLendBike = true;\r\n\r\nconst nav_rentSwitch = document.getElementById('rentSwitch');\r\nconst nav_parkingSwitch = document.getElementById('parkingSwitch');\r\nconst footer_rentSwitch = document.getElementById('footer_rentSwitch');\r\nconst footer_parkingSwitch = document.getElementById('footer_parkingSwitch');\r\n\r\nnav_rentSwitch.addEventListener('click',()=>{if(rentSwitch.checked) isLendBike = true;});\r\nnav_parkingSwitch.addEventListener('click',()=>{if(parkingSwitch.checked) isLendBike = false;});\r\nfooter_rentSwitch.addEventListener('click',()=>{if(footer_rentSwitch.checked) isLendBike = true;});\r\nfooter_parkingSwitch.addEventListener('click',()=>{if(footer_parkingSwitch.checked) isLendBike = false;});\r\n","const logoYoubike = lottie.loadAnimation({\r\n    wrapper: lottie_youbike,\r\n    animType: 'svg',\r\n    loop: true,\r\n    autoplay: false,\r\n    path: './assets/images/youbike.json'\r\n});\r\n\r\nlogoYoubike.play();\r\n","// header 驗證\r\nfunction getAuthorizationHeader() {\r\n    let AppID = '9eeb30e3588740618367a446631cbc3f';\r\n    let AppKey = 'CKTwBadJd3_0_EdqiXE0kEg8fTw';\r\n    let GMTString = new Date().toGMTString();\r\n    let ShaObj = new jsSHA('SHA-1', 'TEXT');\r\n    ShaObj.setHMACKey(AppKey, 'TEXT');\r\n    ShaObj.update('x-date: ' + GMTString);\r\n    let HMAC = ShaObj.getHMAC('B64');\r\n    let Authorization = 'hmac username=\\\"' + AppID + '\\\", algorithm=\\\"hmac-sha1\\\", headers=\\\"x-date\\\", signature=\\\"' + HMAC + '\\\"';\r\n    return { 'Authorization': Authorization, 'X-Date': GMTString }; \r\n}\r\n"]}