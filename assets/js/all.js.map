{"version":3,"sources":["_bike.js","_lottieLogo.js","_valid.js"],"names":["pos_lat","pos_lng","bikeMap","L","map","setView","height","window","innerHeight","addEventListener","isLendBike","nav_rentSwitch","document","getElementById","nav_parkingSwitch","footer_rentSwitch","footer_parkingSwitch","returnLayer","set_lendMarkers","removeLayer","lendLayer","set_returnMarkers","onload","getCurrentPos","gps_currentPos","querySelector","opener","location","href","reload","navigator","geolocation","getCurrentPosition","success","error","alert","code","PERMISSION_DENIED","console","log","POSITION_UNAVAILABLE","TIMEOUT","UNKNOWN_ERROR","pos","coords","latitude","longitude","tileLayer","attribution","maxZoom","id","tileSize","zoomOffset","accessToken","addTo","posGPSIcon","divIcon","iconSize","html","marker","icon","gpsYoubike","lottie","loadAnimation","wrapper","lottie_GPS","animType","loop","autoplay","path","play","get_nearbyStation","sourceData","lat","lng","endpoint","axios","get","headers","getAuthorizationHeader","then","response","data","get_nearbyAvailability","err","newData","availableData","forEach","sourceItem","newItem","StationUID","StationName","StationAddress","StationPosition","push","el","lendIcon","iconAnchor","popupAnchor","AvailableRentBikes","stationStatus","stationStatus_class","ServiceStatus","popUpContent","Zh_tw","AvailableReturnBikes","PositionLat","PositionLon","bindPopup","setPopupContent","returnIcon","AppID","AppKey","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","HMAC","getHMAC","Authorization"],"mappings":"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","file":"all.js","sourcesContent":["// 全域變數\r\nlet pos_lat; // 緯度\r\nlet pos_lng; // 經度\r\nconst bikeMap = L.map('map_show').setView([25.04, 121.54], 16);\r\n\r\nlet height = window.innerHeight;\r\nwindow.addEventListener('resize',() => height=window.innerHeight);\r\n\r\n// 監聽目前欲查詢狀態：租車 or 還車\r\nlet isLendBike = true;\r\n\r\nconst nav_rentSwitch = document.getElementById('rentSwitch');\r\nconst nav_parkingSwitch = document.getElementById('parkingSwitch');\r\nconst footer_rentSwitch = document.getElementById('footer_rentSwitch');\r\nconst footer_parkingSwitch = document.getElementById('footer_parkingSwitch');\r\n\r\nnav_rentSwitch.addEventListener('click',()=>{\r\n  isLendBike = true;\r\n  if(returnLayer) {\r\n    set_lendMarkers();\r\n    bikeMap.removeLayer(returnLayer);\r\n  };\r\n});\r\nnav_parkingSwitch.addEventListener('click',()=>{\r\n  isLendBike = false;\r\n  if(lendLayer) {\r\n    set_returnMarkers();\r\n    bikeMap.removeLayer(lendLayer);\r\n  };\r\n});\r\nfooter_rentSwitch.addEventListener('click',()=>{\r\n  isLendBike = true;\r\n  if(returnLayer) {\r\n    set_lendMarkers();\r\n    bikeMap.removeLayer(returnLayer);\r\n  };\r\n});\r\nfooter_parkingSwitch.addEventListener('click',()=>{\r\n  isLendBike = false;\r\n  if(lendLayer) {\r\n    set_returnMarkers();\r\n    bikeMap.removeLayer(lendLayer);\r\n  };\r\n});\r\n\r\n\r\n// markerCluster 合併標記點\r\n// let lendMarkers;\r\n// let returnMarkers;\r\n\r\n// 頁面初始渲染：取得目前所在位置經緯度座標並標記\r\nwindow.onload = getCurrentPos();\r\n\r\n// 監聽\"附近\"圖示，重置當前位置\r\nconst gps_currentPos = document.querySelector('.gps_currentPos');\r\ngps_currentPos.addEventListener('click',()=>{\r\n  if(pos_lat && pos_lng){\r\n    bikeMap.setView([pos_lat,pos_lng], 16);\r\n  } else {\r\n    window.opener.location.href=window.opener.location.href;\r\n    window.opener.location.reload();\r\n  }\r\n});\r\n\r\n// 取得使用者目前所在位置、載入地圖圖資、標記當前位置\r\n// 判斷當前頁面導入適當功能\r\nfunction getCurrentPos(){\r\n  \r\n  // 先判斷使用者裝置是否有 navigator.geolocation 功能，並執行之\r\n  if(navigator.geolocation){\r\n      navigator.geolocation.getCurrentPosition(success, error);\r\n      // navigator.geolocation.watchPosition(success, error);\r\n    } else {\r\n      // 若出現錯誤，先自動將定位定在台北市中心\r\n      pos_lat = 25.04;\r\n      pos_lng = 121.54;\r\n      alert('您的裝置不支援地理位置功能');\r\n    }\r\n  \r\n  // fun：錯誤訊息處理\r\n  function error(error){\r\n    // 若出現錯誤，先自動將定位定在台北市中心\r\n    pos_lat = 25.04;\r\n    pos_lng = 121.54;\r\n    // 各種錯誤碼類型\r\n    switch(error.code)  {\r\n      case error.PERMISSION_DENIED:\r\n          console.log(\"User denied the request for Geolocation.\");\r\n          break;\r\n\r\n      case error.POSITION_UNAVAILABLE:\r\n          console.log(\"Location information is unavailable.\");\r\n          break;\r\n\r\n      case error.TIMEOUT:\r\n          console.log(\"The request to get user location timed out.\");\r\n          break;\r\n\r\n      case error.UNKNOWN_ERROR:\r\n          console.log(\"An unknown error occurred.\");\r\n          break;\r\n    }\r\n  }\r\n\r\n  // fun：成功執行\r\n  function success(pos){\r\n    // 獲取目前位置經緯度\r\n    pos_lat = pos.coords.latitude;\r\n    pos_lng = pos.coords.longitude;\r\n    console.log(pos.coords.latitude,pos.coords.longitude);\r\n\r\n    // 設定地圖：以當前座標為中心點\r\n    bikeMap.setView([pos_lat,pos_lng], 16);\r\n    // let bikeMap = L.map('map_show', {\r\n    //     center: [pos_lat,pos_lng],\r\n    //     zoom: 16\r\n    // })\r\n\r\n    // 載入圖磚\r\n    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\r\n        attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n        maxZoom: 19,\r\n        id: 'mapbox/streets-v11',\r\n        tileSize: 512,\r\n        zoomOffset: -1,\r\n        accessToken: 'pk.eyJ1Ijoic3lsdmlhaC10dyIsImEiOiJja3c2Nzl2eHUweXlmMnFtZTRjb2VjcDQxIn0.Gx5M_zr8rDs4T-jawF2UDQ'\r\n    }).addTo(bikeMap);\r\n\r\n    // 目前所在位置 GPS 圖示內容\r\n    let posGPSIcon = L.divIcon({\r\n        iconSize: [70,70],\r\n        html: `<div id=\"lottie_GPS\"></div>`\r\n    });\r\n\r\n    // 在地圖上標記所在位置 GPS 圖示\r\n    L.marker([pos_lat,pos_lng], {icon: posGPSIcon}).addTo(bikeMap);\r\n\r\n    // 顯示所在位置 GPS 圖示 lottie 動畫\r\n    const gpsYoubike = lottie.loadAnimation({\r\n    wrapper: lottie_GPS,\r\n    animType: 'svg',\r\n    loop: true,\r\n    autoplay: false,\r\n    path: './assets/images/youbike_GPS.json'\r\n    });\r\n    gpsYoubike.play();\r\n\r\n    // 取得附近站點資訊\r\n    get_nearbyStation(pos_lat,pos_lng);\r\n\r\n  }\r\n\r\n}\r\n\r\n// 取得站點資訊，並賦予到 sourceData\r\nlet sourceData = [];\r\nfunction get_nearbyStation(lat,lng){\r\n  const endpoint = `https://ptx.transportdata.tw/MOTC/v2/Bike/Station/NearBy?$spatialFilter=nearby(${lat},${lng},1000)&$format=JSON`;\r\n\r\n  axios.get(endpoint,\r\n    {\r\n      headers: getAuthorizationHeader()\r\n    })\r\n  .then(response => {\r\n    sourceData = response.data;\r\n    get_nearbyAvailability(lat,lng);\r\n  })\r\n  .catch(err => console.log(err));\r\n\r\n}\r\n\r\n// 取得站點進階資訊，並整合到 newData\r\n// 判斷當前的 isLend 變數值，呈現不同的 marker\r\nlet newData = [];\r\nfunction get_nearbyAvailability(lat,lng){\r\n  const endpoint = `https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/NearBy?$spatialFilter=nearby(${lat},${lng},1000)&$format=JSON`;\r\n  axios.get(endpoint,\r\n    {\r\n      headers: getAuthorizationHeader()\r\n    })\r\n  .then(function (response) {\r\n    const availableData = response.data;\r\n    sourceData.forEach(sourceItem=>{\r\n      availableData.forEach(newItem=>{\r\n        if(sourceItem.StationUID === newItem.StationUID){\r\n          newItem.StationName = sourceItem.StationName;\r\n          newItem.StationAddress = sourceItem.StationAddress;\r\n          newItem.StationPosition = sourceItem.StationPosition;\r\n          newData.push(newItem);\r\n        }\r\n      });\r\n    });\r\n    set_lendMarkers();\r\n  })\r\n  .catch(err => console.log(err));\r\n}\r\n\r\n// 標記租車站點與數量（黃色）\r\nlet lendLayer = null;\r\nfunction set_lendMarkers(){\r\n  // lendMarkers = new L.MarkerClusterGroup().addTo(bikeMap);\r\n  newData.forEach(el=>{\r\n    // 站點圖示\r\n    let lendIcon = L.divIcon({\r\n      iconSize: [0,0],\r\n      iconAnchor: [22, 94],\r\n      popupAnchor: [-3, -76],\r\n      html: `\r\n      <div class=\"lendIcon\">\r\n        <img src=\"./assets/images/icons/stationMark_yellow.svg\"/>\r\n        <div class=\"bikeNum\">\r\n          <span>${el.AvailableRentBikes}</span>\r\n        </div>\r\n      </div`\r\n    });\r\n\r\n    // 站點營運狀態判斷\r\n    let stationStatus;\r\n    let stationStatus_class;\r\n    switch (el.ServiceStatus) {\r\n      // [0:'停止營運',1:'正常營運',2:'暫停營運'] \r\n      case 0:\r\n        stationStatus = '停止營運';\r\n        stationStatus_class = 'bg-danger';\r\n        break;\r\n      case 1:\r\n        stationStatus = '正常營運';\r\n        stationStatus_class = 'bg-success';\r\n        break;\r\n      case 2:\r\n        stationStatus = '暫停營運';\r\n        stationStatus_class = 'bg-dark';\r\n        break;\r\n    }\r\n\r\n    // popUp 內容\r\n    let popUpContent = `\r\n      <p class=\"fz-5 fw-bold my-4 me-2\">${el.StationName.Zh_tw}</p>\r\n      <a class=\"rounded-pill bg-blue text-white py-2 px-3 mb-2\" href=\"https://www.google.com/maps/search/?api=1&map_action=map&zoom=16&query=(${el.StationAddress.Zh_tw})\">\r\n        使用 GoogleMap 導航\r\n      </a>\r\n      <span class=\"fz-3 badge py-2 px-2 ms-2 ${stationStatus_class}\">\r\n        ${stationStatus}\r\n      </span>\r\n      <div class=\"row d-flex\">\r\n        <div class=\"col-6 py-3 fz-3 fw-bold text-center\">\r\n          可借車輛\r\n          <p class=\"fz-10 fw-bold text-success m-0\">\r\n            ${el.AvailableRentBikes}\r\n          </p>\r\n        </div>\r\n        <div class=\"col-6 py-3 fz-3 fw-bold text-center\">\r\n          可停空位\r\n          <p class=\"fz-10 fw-bold text-warning m-0\">\r\n            ${el.AvailableReturnBikes}\r\n          </p>\r\n        </div>\r\n      </div>`;\r\n\r\n    const lat = el.StationPosition.PositionLat;\r\n    const lng = el.StationPosition.PositionLon;\r\n\r\n    // 標記站點黃色 icon & 為站點綁上 popUp 彈跳視窗\r\n    lendLayer = L.marker([lat,lng], {icon: lendIcon})\r\n    .bindPopup().setPopupContent(popUpContent);\r\n    lendLayer.addTo(bikeMap);\r\n    // lendMarkers.addLayer(lendLayer);\r\n  });\r\n  // bikeMap.addLayer(lendMarkers);\r\n}\r\n\r\n// 標記還車站點與數量（黑色）\r\nlet returnLayer = null;\r\nfunction set_returnMarkers(){\r\n  // returnMarkers = new L.MarkerClusterGroup().addTo(bikeMap);\r\n  newData.forEach(el=>{\r\n    // 站點圖示\r\n    let returnIcon = L.divIcon({\r\n      iconSize: [0,0],\r\n      iconAnchor: [22, 94],\r\n      popupAnchor: [-3, -76],\r\n      html: `\r\n      <div class=\"returnIcon\">\r\n        <img src=\"./assets/images/icons/stationMark_black.svg\"/>\r\n        <div class=\"bikeNum\">\r\n          <span class=\"text-primary\">${el.AvailableReturnBikes}</span>\r\n        </div>\r\n      </div`\r\n    });\r\n\r\n    // 站點營運狀態判斷\r\n    let stationStatus;\r\n    let stationStatus_class;\r\n    switch (el.ServiceStatus) {\r\n      // [0:'停止營運',1:'正常營運',2:'暫停營運'] \r\n      case 0:\r\n        stationStatus = '停止營運';\r\n        stationStatus_class = 'bg-danger';\r\n        break;\r\n      case 1:\r\n        stationStatus = '正常營運';\r\n        stationStatus_class = 'bg-success';\r\n        break;\r\n      case 2:\r\n        stationStatus = '暫停營運';\r\n        stationStatus_class = 'bg-dark';\r\n        break;\r\n    }\r\n\r\n    // popUp 內容\r\n    let popUpContent = `\r\n      <p class=\"fz-5 fw-bold my-4 me-2\">${el.StationName.Zh_tw}</p>\r\n      <a class=\"rounded-pill bg-blue text-white py-2 px-3 mb-2\" href=\"https://www.google.com/maps/search/?api=1&map_action=map&zoom=16&query=(${el.StationAddress.Zh_tw})\">\r\n        使用 GoogleMap 導航\r\n      </a>\r\n      <span class=\"fz-3 badge py-2 px-2 ms-2 ${stationStatus_class}\">\r\n        ${stationStatus}\r\n      </span>\r\n      <div class=\"row d-flex\">\r\n        <div class=\"col-6 py-3 fz-3 fw-bold text-center\">\r\n          可借車輛\r\n          <p class=\"fz-10 fw-bold text-success m-0\">\r\n            ${el.AvailableRentBikes}\r\n          </p>\r\n        </div>\r\n        <div class=\"col-6 py-3 fz-3 fw-bold text-center\">\r\n          可停空位\r\n          <p class=\"fz-10 fw-bold text-warning m-0\">\r\n            ${el.AvailableReturnBikes}\r\n          </p>\r\n        </div>\r\n      </div>`;\r\n    \r\n    const lat = el.StationPosition.PositionLat;\r\n    const lng = el.StationPosition.PositionLon;\r\n\r\n    // 標記站點黃色 icon & 為站點綁上 popUp 彈跳視窗\r\n    returnLayer = L.marker([lat,lng], {icon: returnIcon})\r\n    .bindPopup().setPopupContent(popUpContent);\r\n    returnLayer.addTo(bikeMap);\r\n    // returnMarkers.addLayer(returnLayer);\r\n  });\r\n  // bikeMap.addLayer(returnMarkers);\r\n}","","// header 驗證\r\nfunction getAuthorizationHeader() {\r\n    let AppID = '9eeb30e3588740618367a446631cbc3f';\r\n    let AppKey = 'CKTwBadJd3_0_EdqiXE0kEg8fTw';\r\n    let GMTString = new Date().toGMTString();\r\n    let ShaObj = new jsSHA('SHA-1', 'TEXT');\r\n    ShaObj.setHMACKey(AppKey, 'TEXT');\r\n    ShaObj.update('x-date: ' + GMTString);\r\n    let HMAC = ShaObj.getHMAC('B64');\r\n    let Authorization = 'hmac username=\\\"' + AppID + '\\\", algorithm=\\\"hmac-sha1\\\", headers=\\\"x-date\\\", signature=\\\"' + HMAC + '\\\"';\r\n    return { 'Authorization': Authorization, 'X-Date': GMTString }; \r\n}\r\n"]}