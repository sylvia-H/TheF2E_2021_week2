{"version":3,"sources":["_bike.js","_index.js","_valid.js"],"names":["pos_latitude","pos_longitude","bikeMap","getBikeStation_nearby","endpoint","axios","get","headers","getAuthorizationHeader","then","response","thisData","data","forEach","el","lat","lon","stationName","StationPosition","PositionLat","PositionLon","StationName","Zh_tw","console","log","StationUID","lendIcon","L","divIcon","iconSize","iconAnchor","popupAnchor","html","popUpContent","BikesCapacity","StationAddress","marker","icon","addTo","bindPopup","setPopupContent","getBikeStation_nearby2","error","targetStation","filter","stationIcon","document","querySelector","innerHTML","AvailableRentBikes","AvailableReturnBikes","getPosition","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","UNKNOWN_ERROR","success","pos","coords","latitude","longitude","accuracy","navigator","geolocation","watchPosition","alert","init","map","center","zoom","setView","tileLayer","attribution","maxZoom","id","tileSize","zoomOffset","accessToken","posGpsIcon","window","onload","setTimeout","logoYoubike","lottie","loadAnimation","wrapper","lottie_youbike","animType","loop","autoplay","path","play","gpsYoubike","lottie_youbike_GPS","AppID","AppKey","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","HMAC","getHMAC","Authorization"],"mappings":";;AAAA,IAAIA,YAAY,GAAG,KAAnB;AACA,IAAIC,aAAa,GAAG,MAApB;AACA,IAAIC,OAAJ,C,CAEA;;AACA,SAASC,qBAAT,GAAgC;AAC9B,MAAMC,QAAQ,oGAA6FJ,YAA7F,cAA6GC,aAA7G,wBAAd;AAEAI,EAAAA,KAAK,CAACC,GAAN,CAAUF,QAAV,EACG;AACGG,IAAAA,OAAO,EAAEC,sBAAsB;AADlC,GADH,EAKGC,IALH,CAKQ,UAAUC,QAAV,EAAoB;AACxB,QAAMC,QAAQ,GAAGD,QAAQ,CAACE,IAA1B;AAEAD,IAAAA,QAAQ,CAACE,OAAT,CAAiB,UAAAC,EAAE,EAAE;AACnB,UAAIC,GAAJ;AACA,UAAIC,GAAJ;AACA,UAAIC,WAAW,GAAG,EAAlB;;AAEA,UAAGH,EAAE,CAACI,eAAH,CAAmBC,WAAtB,EAAmC;AACjCJ,QAAAA,GAAG,GAAGD,EAAE,CAACI,eAAH,CAAmBC,WAAzB;AACD,OAFD,MAEO;AACLJ,QAAAA,GAAG,GAAGf,YAAN;AACD;;AACD,UAAGc,EAAE,CAACI,eAAH,CAAmBE,WAAtB,EAAmC;AACjCJ,QAAAA,GAAG,GAAGF,EAAE,CAACI,eAAH,CAAmBE,WAAzB;AACD,OAFD,MAEO;AACLJ,QAAAA,GAAG,GAAGf,aAAN;AACD;;AAED,UAAGa,EAAE,CAACO,WAAN,EAAmB;AACjBJ,QAAAA,WAAW,GAAGH,EAAE,CAACO,WAAH,CAAeC,KAA7B;AACD,OAFD,MAEO;AACLL,QAAAA,WAAW,GAAG,EAAd;AACD;;AAEDM,MAAAA,OAAO,CAACC,GAAR,CAAYV,EAAE,CAACW,UAAf;AACRF,MAAAA,OAAO,CAACC,GAAR,eAAmBT,GAAnB,kBAA8BC,GAA9B,0BAAiDC,WAAjD,GAvB2B,CAyBnB;;AACA,UAAIS,QAAQ,GAAGC,CAAC,CAACC,OAAF,CAAU;AACvBC,QAAAA,QAAQ,EAAE,CAAC,CAAD,EAAG,CAAH,CADa;AAEvBC,QAAAA,UAAU,EAAE,CAAC,EAAD,EAAK,EAAL,CAFW;AAGvBC,QAAAA,WAAW,EAAE,CAAC,CAAC,CAAF,EAAK,CAAC,EAAN,CAHU;AAIvBC,QAAAA,IAAI,+KAIelB,EAAE,CAACW,UAJlB;AAJmB,OAAV,CAAf,CA1BmB,CAuCnB;;AACA,UAAIQ,YAAY,yBACZhB,WADY,kEAELH,EAAE,CAACoB,aAFE,sDAGPpB,EAAE,CAACqB,cAAH,CAAkBb,KAHX,iIAIqFR,EAAE,CAACqB,cAAH,CAAkBb,KAJvG,wEAAhB,CAxCmB,CAgDnB;;AACAK,MAAAA,CAAC,CAACS,MAAF,CAAS,CAACrB,GAAD,EAAKC,GAAL,CAAT,EAAoB;AAACqB,QAAAA,IAAI,EAAEX;AAAP,OAApB,EAAsCY,KAAtC,CAA4CpC,OAA5C,EACCqC,SADD,GACaC,eADb,CAC6BP,YAD7B,EAjDmB,CAoDnB;;AACAQ,MAAAA,sBAAsB,CAAC3B,EAAE,CAACW,UAAJ,CAAtB;AAED,KAvDD;AAwDD,GAhEH,WAiES,UAAUiB,KAAV,EAAiB;AACtBnB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACD,GAnEH;AAqED,C,CAGD;;;AACA,SAASD,sBAAT,CAAgChB,UAAhC,EAA2C;AACzC,MAAMrB,QAAQ,yGAAkGJ,YAAlG,cAAkHC,aAAlH,wBAAd;AACAI,EAAAA,KAAK,CAACC,GAAN,CAAUF,QAAV,EACG;AACGG,IAAAA,OAAO,EAAEC,sBAAsB;AADlC,GADH,EAKGC,IALH,CAKQ,UAAUC,QAAV,EAAoB;AACxB,QAAMC,QAAQ,GAAGD,QAAQ,CAACE,IAA1B;AACA,QAAM+B,aAAa,GAAGhC,QAAQ,CAACiC,MAAT,CAAgB,UAAA9B,EAAE;AAAA,aAAGA,EAAE,CAACW,UAAH,KAAkBA,UAArB;AAAA,KAAlB,CAAtB;AACA,QAAMoB,WAAW,GAAGC,QAAQ,CAACC,aAAT,YAA2BtB,UAA3B,EAApB;AACAoB,IAAAA,WAAW,CAACG,SAAZ,GAAwBL,aAAa,CAAC,CAAD,CAAb,CAAiBM,kBAAzC;AACA1B,IAAAA,OAAO,CAACC,GAAR,CAAYqB,WAAZ;AACAtB,IAAAA,OAAO,CAACC,GAAR,CAAYmB,aAAa,CAAC,CAAD,CAAzB;AACApB,IAAAA,OAAO,CAACC,GAAR,yCAAoBmB,aAAa,CAAC,CAAD,CAAb,CAAiBM,kBAArC;AACA1B,IAAAA,OAAO,CAACC,GAAR,yCAAoBmB,aAAa,CAAC,CAAD,CAAb,CAAiBO,oBAArC;AACD,GAdH,WAeS,UAAUR,KAAV,EAAiB;AACtBnB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACD,GAjBH;AAmBD,C,CAED;;;AACA,SAASS,WAAT,GAAsB;AACpB;AACA,WAAST,KAAT,CAAeA,KAAf,EAAqB;AACnB,YAAOA,KAAK,CAACU,IAAb;AACE,WAAKV,KAAK,CAACW,iBAAX;AACI9B,QAAAA,OAAO,CAACC,GAAR,CAAY,0CAAZ;AACA;;AAEJ,WAAKkB,KAAK,CAACY,oBAAX;AACI/B,QAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACA;;AAEJ,WAAKkB,KAAK,CAACa,OAAX;AACIhC,QAAAA,OAAO,CAACC,GAAR,CAAY,6CAAZ;AACA;;AAEJ,WAAKkB,KAAK,CAACc,aAAX;AACIjC,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACA;AAfN;AAiBD;;AAED,WAASiC,OAAT,CAAiBC,GAAjB,EAAqB;AACnB1D,IAAAA,YAAY,GAAG0D,GAAG,CAACC,MAAJ,CAAWC,QAA1B;AACA3D,IAAAA,aAAa,GAAGyD,GAAG,CAACC,MAAJ,CAAWE,SAA3B;AACAtC,IAAAA,OAAO,CAACC,GAAR,yBAAwBkC,GAAG,CAACC,MAAJ,CAAWG,QAAnC;AACAvC,IAAAA,OAAO,CAACC,GAAR,CAAYkC,GAAG,CAACC,MAAJ,CAAWC,QAAvB,EAAgCF,GAAG,CAACC,MAAJ,CAAWE,SAA3C;AACD;;AAED,MAAGE,SAAS,CAACC,WAAb,EAAyB;AACvB;AACAD,IAAAA,SAAS,CAACC,WAAV,CAAsBC,aAAtB,CAAoCR,OAApC,EAA6Cf,KAA7C;AACD,GAHD,MAGO;AACLwB,IAAAA,KAAK,CAAC,eAAD,CAAL;AACD;AACF;;AAED,SAASC,IAAT,GAAe;AACX5C,EAAAA,OAAO,CAACC,GAAR,6BAA4BxB,YAA5B;AACAuB,EAAAA,OAAO,CAACC,GAAR,8BAA6BvB,aAA7B;AAEFC,EAAAA,OAAO,GAAGyB,CAAC,CAACyC,GAAF,CAAM,cAAN,EAAsB;AAC5BC,IAAAA,MAAM,EAAE,CAACrE,YAAD,EAAcC,aAAd,CADoB;AAE5BqE,IAAAA,IAAI,EAAE;AAFsB,GAAtB,EAGPC,OAHO,CAGC,CAACvE,YAAD,EAAcC,aAAd,CAHD,EAG+B,EAH/B,CAAV;AAKA0B,EAAAA,CAAC,CAAC6C,SAAF,CAAY,oFAAZ,EAAkG;AAC9FC,IAAAA,WAAW,EAAE,0JADiF;AAE9FC,IAAAA,OAAO,EAAE,EAFqF;AAG9FC,IAAAA,EAAE,EAAE,oBAH0F;AAI9FC,IAAAA,QAAQ,EAAE,GAJoF;AAK9FC,IAAAA,UAAU,EAAE,CAAC,CALiF;AAM9FC,IAAAA,WAAW,EAAE;AANiF,GAAlG,EAOGxC,KAPH,CAOSpC,OAPT,EATa,CAmBX;;AACA,MAAI6E,UAAU,GAAGpD,CAAC,CAACC,OAAF,CAAU;AACvBC,IAAAA,QAAQ,EAAE,CAAC,EAAD,EAAI,EAAJ,CADa;AAEvBG,IAAAA,IAAI;AAFmB,GAAV,CAAjB,CApBW,CAyBX;;AACA,MAAII,MAAM,GAAGT,CAAC,CAACS,MAAF,CAAS,CAACpC,YAAD,EAAcC,aAAd,CAAT,EAAuCqC,KAAvC,CAA6CpC,OAA7C,CAAb,CA1BW,CA4BX;;AACAC,EAAAA,qBAAqB;AACxB,C,CAED;;;AACA6E,MAAM,CAACC,MAAP,GAAgB9B,WAAW,EAA3B,C,CAEA;;AACA+B,UAAU,CAACf,IAAD,EAAO,GAAP,CAAV;;;AClLA,IAAMgB,WAAW,GAAGC,MAAM,CAACC,aAAP,CAAqB;AACrCC,EAAAA,OAAO,EAAEC,cAD4B;AAErCC,EAAAA,QAAQ,EAAE,KAF2B;AAGrCC,EAAAA,IAAI,EAAE,IAH+B;AAIrCC,EAAAA,QAAQ,EAAE,KAJ2B;AAKrCC,EAAAA,IAAI,EAAE;AAL+B,CAArB,CAApB;AAQAR,WAAW,CAACS,IAAZ;AAEA,IAAMC,UAAU,GAAGT,MAAM,CAACC,aAAP,CAAqB;AACpCC,EAAAA,OAAO,EAAEQ,kBAD2B;AAEpCN,EAAAA,QAAQ,EAAE,KAF0B;AAGpCC,EAAAA,IAAI,EAAE,IAH8B;AAIpCC,EAAAA,QAAQ,EAAE,KAJ0B;AAKpCC,EAAAA,IAAI,EAAE;AAL8B,CAArB,CAAnB;AAQAE,UAAU,CAACD,IAAX;;;AClBA;AACA,SAASpF,sBAAT,GAAkC;AAC9B,MAAIuF,KAAK,GAAG,kCAAZ;AACA,MAAIC,MAAM,GAAG,6BAAb;AACA,MAAIC,SAAS,GAAG,IAAIC,IAAJ,GAAWC,WAAX,EAAhB;AACA,MAAIC,MAAM,GAAG,IAAIC,KAAJ,CAAU,OAAV,EAAmB,MAAnB,CAAb;AACAD,EAAAA,MAAM,CAACE,UAAP,CAAkBN,MAAlB,EAA0B,MAA1B;AACAI,EAAAA,MAAM,CAACG,MAAP,CAAc,aAAaN,SAA3B;AACA,MAAIO,IAAI,GAAGJ,MAAM,CAACK,OAAP,CAAe,KAAf,CAAX;AACA,MAAIC,aAAa,GAAG,qBAAqBX,KAArB,GAA6B,+DAA7B,GAA+FS,IAA/F,GAAsG,IAA1H;AACA,SAAO;AAAE,qBAAiBE,aAAnB;AAAkC,cAAUT;AAA5C,GAAP;AACH","file":"all.js","sourcesContent":["let pos_latitude = 25.04;\r\nlet pos_longitude = 121.54;\r\nvar bikeMap;\r\n\r\n// 取得附近一公里內 30 筆站點資訊\r\nfunction getBikeStation_nearby(){\r\n  const endpoint = `https://ptx.transportdata.tw/MOTC/v2/Bike/Station/NearBy?$top=30&$spatialFilter=nearby(${pos_latitude},${pos_longitude},1000)&$format=JSON`;\r\n\r\n  axios.get(endpoint,\r\n     {\r\n        headers: getAuthorizationHeader()\r\n     }\r\n    )\r\n    .then(function (response) {\r\n      const thisData = response.data;\r\n    \r\n      thisData.forEach(el=>{\r\n        let lat;\r\n        let lon;\r\n        let stationName = \"\";\r\n        \r\n        if(el.StationPosition.PositionLat) {\r\n          lat = el.StationPosition.PositionLat;\r\n        } else {\r\n          lat = pos_latitude;\r\n        }\r\n        if(el.StationPosition.PositionLon) {\r\n          lon = el.StationPosition.PositionLon;\r\n        } else {\r\n          lon = pos_longitude;\r\n        }\r\n        \r\n        if(el.StationName) {\r\n          stationName = el.StationName.Zh_tw;\r\n        } else {\r\n          stationName = \"\";\r\n        }\r\n        \r\n        console.log(el.StationUID);\r\nconsole.log(`lat:${lat},lon:${lon},stationName:${stationName}`);\r\n        \r\n        // 站點圖示\r\n        let lendIcon = L.divIcon({\r\n          iconSize: [0,0],\r\n          iconAnchor: [22, 94],\r\n          popupAnchor: [-3, -76],\r\n          html: `\r\n          <div class=\"lendIcon\">\r\n            <img src=\"https://i.imgur.com/FlALjW8.png\"/>\r\n            <div class=\"bikeNum\">\r\n              <span class=\"${el.StationUID}\">55</span>\r\n            </div>\r\n          </div`\r\n        });\r\n        \r\n        // popUp 內容\r\n        let popUpContent = `\r\n          ${stationName}<br>\r\n          站點車輛總數:${el.BikesCapacity}<br>\r\n          站點地址:${el.StationAddress.Zh_tw}<br>\r\n          <a target=\"_blank\" href=\"https://www.google.com/maps/search/?api=1&map_action=map&zoom=16&query=(${el.StationAddress.Zh_tw})\">\r\n          使用 GoogleMap 導航\r\n          </a>`;\r\n        \r\n        // 標記站點 icon & 為站點綁上 popUp 彈跳視窗\r\n        L.marker([lat,lon], {icon: lendIcon}).addTo(bikeMap)\r\n        .bindPopup().setPopupContent(popUpContent);\r\n        \r\n        // 用 StationUID 查詢站點借還車輛資訊\r\n        getBikeStation_nearby2(el.StationUID);\r\n        \r\n      });\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error);\r\n    }); \r\n\r\n}\r\n\r\n\r\n// 取得附近一公里內 30 筆站點資訊:含借還車輛數量資訊\r\nfunction getBikeStation_nearby2(StationUID){\r\n  const endpoint = `https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/NearBy?$top=30&$spatialFilter=nearby(${pos_latitude},${pos_longitude},1000)&$format=JSON`;\r\n  axios.get(endpoint,\r\n     {\r\n        headers: getAuthorizationHeader()\r\n     }\r\n    )\r\n    .then(function (response) {\r\n      const thisData = response.data;\r\n      const targetStation = thisData.filter(el=> el.StationUID === StationUID);\r\n      const stationIcon = document.querySelector(`.${StationUID}`);\r\n      stationIcon.innerHTML = targetStation[0].AvailableRentBikes;\r\n      console.log(stationIcon);\r\n      console.log(targetStation[0]);\r\n      console.log(`可借數量：${targetStation[0].AvailableRentBikes}`);\r\n      console.log(`還車空位：${targetStation[0].AvailableReturnBikes}`);\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error);\r\n    }); \r\n\r\n}\r\n\r\n// 取得使用者所在位置\r\nfunction getPosition(){\r\n  // 錯誤訊息處理\r\n  function error(error){\r\n    switch(error.code)  {\r\n      case error.PERMISSION_DENIED:\r\n          console.log(\"User denied the request for Geolocation.\");\r\n          break;\r\n\r\n      case error.POSITION_UNAVAILABLE:\r\n          console.log(\"Location information is unavailable.\");\r\n          break;\r\n\r\n      case error.TIMEOUT:\r\n          console.log(\"The request to get user location timed out.\");\r\n          break;\r\n\r\n      case error.UNKNOWN_ERROR:\r\n          console.log(\"An unknown error occurred.\");\r\n          break;\r\n    }\r\n  }\r\n\r\n  function success(pos){\r\n    pos_latitude = pos.coords.latitude;\r\n    pos_longitude = pos.coords.longitude;\r\n    console.log(`Accuracy：${pos.coords.accuracy}`);\r\n    console.log(pos.coords.latitude,pos.coords.longitude);\r\n  }\r\n  \r\n  if(navigator.geolocation){\r\n    // navigator.geolocation.getCurrentPosition(success, error);\r\n    navigator.geolocation.watchPosition(success, error);\r\n  } else {\r\n    alert('您的裝置不支援地理位置功能');\r\n  }\r\n}\r\n\r\nfunction init(){\r\n    console.log(`pos_latitude：${pos_latitude}`);\r\n    console.log(`pos_longitude：${pos_longitude}`);\r\n    \r\n  bikeMap = L.map('bikeMap_show', {\r\n      center: [pos_latitude,pos_longitude],\r\n      zoom: 15\r\n  }).setView([pos_latitude,pos_longitude], 15);\r\n\r\n  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\r\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n      maxZoom: 18,\r\n      id: 'mapbox/streets-v11',\r\n      tileSize: 512,\r\n      zoomOffset: -1,\r\n      accessToken: 'pk.eyJ1Ijoic3lsdmlhaC10dyIsImEiOiJja3c2Nzl2eHUweXlmMnFtZTRjb2VjcDQxIn0.Gx5M_zr8rDs4T-jawF2UDQ'\r\n  }).addTo(bikeMap);\r\n\r\n  \r\n    // 目前所在位置 GPS 圖示\r\n    let posGpsIcon = L.divIcon({\r\n        iconSize: [60,60],\r\n        html: `<div id=\"lottie_youbike_GPS\"></div>`\r\n    });\r\n    \r\n    // 標記 icon\r\n    let marker = L.marker([pos_latitude,pos_longitude]).addTo(bikeMap);\r\n\r\n    // 標記附近站點\r\n    getBikeStation_nearby();\r\n}\r\n\r\n// 初始渲染：取得目前所在位置經緯度座標\r\nwindow.onload = getPosition();\r\n\r\n// 初始渲染：延遲執行地圖載入\r\nsetTimeout(init, 500);\r\n","const logoYoubike = lottie.loadAnimation({\r\n    wrapper: lottie_youbike,\r\n    animType: 'svg',\r\n    loop: true,\r\n    autoplay: false,\r\n    path: './assets/images/youbike.json'\r\n});\r\n\r\nlogoYoubike.play();\r\n\r\nconst gpsYoubike = lottie.loadAnimation({\r\n    wrapper: lottie_youbike_GPS,\r\n    animType: 'svg',\r\n    loop: true,\r\n    autoplay: false,\r\n    path: './assets/images/youbike_GPS.json'\r\n});\r\n\r\ngpsYoubike.play();\r\n","// header 驗證\r\nfunction getAuthorizationHeader() {\r\n    let AppID = '9eeb30e3588740618367a446631cbc3f';\r\n    let AppKey = 'CKTwBadJd3_0_EdqiXE0kEg8fTw';\r\n    let GMTString = new Date().toGMTString();\r\n    let ShaObj = new jsSHA('SHA-1', 'TEXT');\r\n    ShaObj.setHMACKey(AppKey, 'TEXT');\r\n    ShaObj.update('x-date: ' + GMTString);\r\n    let HMAC = ShaObj.getHMAC('B64');\r\n    let Authorization = 'hmac username=\\\"' + AppID + '\\\", algorithm=\\\"hmac-sha1\\\", headers=\\\"x-date\\\", signature=\\\"' + HMAC + '\\\"';\r\n    return { 'Authorization': Authorization, 'X-Date': GMTString }; \r\n}\r\n"]}